let reportAndThrowError,stripLeadingSlash,stripTrailingSlash,fetchLogo,fetchPkg,fetchStats;_347‍.x([["collectiveSlugFromUrl",()=>collectiveSlugFromUrl],["collectiveUrl",()=>collectiveUrl],["collectiveLogoUrl",()=>collectiveLogoUrl],["collectiveDonationText",()=>collectiveDonationText],["getCollective",()=>getCollective],["collectiveDonationUrl",()=>collectiveDonationUrl],["retrieveDonationSlug",()=>retrieveDonationSlug]]);_347‍.w("./misc",[["reportAndThrowError",["reportAndThrowError"],function(v){reportAndThrowError=v}],["stripLeadingSlash",["stripLeadingSlash"],function(v){stripLeadingSlash=v}],["stripTrailingSlash",["stripTrailingSlash"],function(v){stripTrailingSlash=v}]]);_347‍.w("./fetch",[["fetchLogo",["fetchLogo"],function(v){fetchLogo=v}],["fetchPkg",["fetchPkg"],function(v){fetchPkg=v}],["fetchStats",["fetchStats"],function(v){fetchStats=v}]]);


       const collectiveSlugFromUrl = url => url.substr(url.lastIndexOf('/') + 1).toLowerCase().replace(/\.json/g, '');_347‍.j(["collectiveSlugFromUrl"]);

       const collectiveUrl = pkg => {
  const url = pkg.collective && pkg.collective.url

  if (!url) {
    _347‍.a("reportAndThrowError",reportAndThrowError)('No collective URL set!')
  }

  return _347‍.a("stripTrailingSlash",stripTrailingSlash)(url)
};_347‍.j(["collectiveUrl"]);

// use pkg.collective.logo for "legacy"/compatibility reasons
       const collectiveLogoUrl = pkg => pkg.collective.logo || pkg.collective.logoUrl || false;_347‍.j(["collectiveLogoUrl"]);

       const collectiveDonationText = pkg => (pkg.collective.donation && pkg.collective.donation.text) || 'Donate:';_347‍.j(["collectiveDonationText"]);

       const getCollective = async pkgPath => {
  const pkg = _347‍.a("fetchPkg",fetchPkg)(pkgPath)
  const url = collectiveUrl(pkg)
  const baseCollective = {
    url,
    slug: collectiveSlugFromUrl(url),
    logoUrl: collectiveLogoUrl(pkg),
    donationUrl: collectiveDonationUrl(pkg),
    donationText: collectiveDonationText(pkg)
  }
  const logoUrl = baseCollective.logoUrl
  const promises = [_347‍.a("fetchStats",fetchStats)(url)].concat(logoUrl ? _347‍.a("fetchLogo",fetchLogo)(logoUrl) : [])

  const [stats, logo] = await Promise.all(promises)

  return Object.assign(baseCollective, { stats, logo })
};_347‍.j(["getCollective"]);

       const collectiveDonationUrl = pkg => {
  const defaultDonationAmount = pkg.collective.donation && pkg.collective.donation.amount

  let donateUrl = `${collectiveUrl(pkg)}/${retrieveDonationSlug(pkg)}`

  if (defaultDonationAmount) {
    return `${donateUrl}/${defaultDonationAmount}`
  }

  return donateUrl
};_347‍.j(["collectiveDonationUrl"]);

       const retrieveDonationSlug = pkg => {
  const rawDonationSlug = (pkg.collective.donation && pkg.collective.donation.slug)

  if (!rawDonationSlug) {
    return 'donate'
  }

  return _347‍.a("stripLeadingSlash",stripLeadingSlash)(rawDonationSlug)
};_347‍.j(["retrieveDonationSlug"]);
